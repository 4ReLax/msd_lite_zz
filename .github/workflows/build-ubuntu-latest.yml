name: build-arm64-simple

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  cross-compile-arm64:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: recursive
    
    - name: Install ARM64 cross-compiler
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          cmake \
          gcc-aarch64-linux-gnu \
          g++-aarch64-linux-gnu \
          file
        
    - name: Build for ARM64
      run: |
        mkdir build && cd build
        cmake .. \
          -DCMAKE_SYSTEM_NAME=Linux \
          -DCMAKE_SYSTEM_PROCESSOR=aarch64 \
          -DCMAKE_C_COMPILER=aarch64-linux-gnu-gcc \
          -DCMAKE_CXX_COMPILER=aarch64-linux-gnu-g++ \
          -DCMAKE_BUILD_TYPE=Release \
          -DENABLE_TESTS=0
        make -j$(nproc)
        
    - name: Verify ARM64 binary
      run: |
        file build/src/msd_lite
        echo "Build completed successfully!"
        
    - name: Upload binary
      uses: actions/upload-artifact@v3
      with:
        name: msd_lite-arm64
        path: build/src/msd_lite
